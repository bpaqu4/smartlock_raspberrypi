This smart lock project uses a Raspberry Pi to control a locking servo. The lock has a standard 4 x 4 keypad and an inside button attached as connected inputs. A red/green LED output is used with the outside keypad.
The smart lock functionality includes Bluetooth proximity detection and an app. The app is capable of locking or unlocking the door, checking lock status, changing either of the 2 MAC addresses stored, changing the passcode, setting a temporary passcode and the number of hours it will be active, and toggling an automatic relock setting on or off. The app was made in MIT App Inventor 2 and the .aia file is included. This project uses Google Firestore for app updating and lock control.
Creating your own Firestore project and database will be required. Add your Firestore key file into the python code on the Raspberry Pi and the correct rest API URLs into the app. 

Getting started on Raspberry Pi - 

To start the lock program on your Raspberry Pi, create a virtual environment and install the firebase_admin and pigpio packages. Start pigpio through your command line as well as pair and trust the desired Bluetooth device(s). 
Edit the directory to your Firestore credentials json file you can download from your Firebase project to line 12 of the Python code. Attach components to the board pins referenced in the code. Make sure your Firebase collection, document, and fields names match what you have in your Python file. 

Functionality and Adjustments-
The lock allows you to unlock or lock the door from the inside button without any checks. The lock-unlock button for the outside is set to '#' on the keypad. While unlocked, it will check your Firestore database every .6 seconds for a lock or reboot command change through the app. That time period can be changed but being mindful of the number of Firestore reads you make is suggested. See Firestore free account limits and pricing. 
If a lock command from the app, an inside button press, or a '#' press on the keypad occurs, the door will lock. Once locked, it will update Firebase and thus the app with the current lock status. It will then check Firestore for an unlock command. If any keypad buttons are pressed, it stores them in the enteredCode string until '#' is pressed. Entering the passcode has a timeout currently set to 2.6 seconds that refreshes on every button press. If the entered code matches the stored passcode the door will unlock. If it does not match, it will check for a temporary code. If it matches the temporary code then the time that was stored on firebase when the temporary code was made will be checked against the current time. If the temporary code is still valid it will unlock. If not then all temporary code variables will be reset. If a code is not entered, but '#' is pressed, then an OS command will be sent to the Raspberry Pi to attempt to connect to Bluetooth device 1. If a connection is successful, it will obtain the RSSI value. If the RSSI shows the device is closer than the range set, it will unlock. If no connection is made, it will check for Bluetooth device 2. The LEDs will provide visual feedback for button presses and either failed or successful unlock attempts. 
Your desired passcode timeout, firebase check time interval, and RSSI range can be edited in the declarations at the top of the Python code. 
